from shapely import geometry
from analysis_lib.behaviour.arena_setup_adapter import CircleGeometry, Point, RectangleGeometry
from analysis_lib.behaviour.polygons import polygon_from_circle, polygon_from_rect


def test_rect_polygon_has_correct_corners_without_rotation():
    rect = RectangleGeometry(top_left=Point(
        x=1, y=1), width=5, height=5, rotation=0)
    polygon = polygon_from_rect(rect)

    assert polygon.exterior.coords[0] == (1.0, 1.0)
    assert polygon.exterior.coords[1] == (6.0, 1.0)
    assert polygon.exterior.coords[2] == (6.0, 6.0)
    assert polygon.exterior.coords[3] == (1.0, 6.0)


def test_rect_polygon_has_correct_corners_with_rotation():
    rect = RectangleGeometry(top_left=Point(
        x=1, y=1), width=5, height=5, rotation=10)
    polygon = polygon_from_rect(rect)

    assert polygon.exterior.coords[0] == (
        1.4721010616368058, 0.6038601733021542)
    assert polygon.exterior.coords[1] == (
        6.396139826697846, 1.4721010616368058)
    assert polygon.exterior.coords[2] == (
        5.527898938363194, 6.396139826697846)
    assert polygon.exterior.coords[3] == (
        0.6038601733021541, 5.527898938363194)


def test_ellipse_polygon_has_correct_shape():
    ellipse = CircleGeometry(center=Point(
        x=0, y=0), radius_x=10, radius_y=5, rotation=45)
    polygon = polygon_from_circle(ellipse)

    assert polygon.almost_equals(expected_ellipse)


expected_ellipse = geometry.Polygon((
    (7.071067811865476, 7.071067811865476),
    (7.383561610629641, 6.690475764634185),
    (7.624947674818096, 6.245450778403382),
    (7.792901324677657, 5.740278687065872),
    (7.885805074747376, 5.179824574016394),
    (7.902764211127724, 4.569485918738994),
    (7.843615408064551, 3.915140616129043),
    (7.70892830086538, 3.223090369152202),
    (7.500000000000003, 2.500000000000006),
    (7.218842599217578, 1.752833264208795),
    (6.868163797983913, 0.9887857858871221),
    (6.451340824855416, 0.2152157599220632),
    (5.972387912921933, -0.5604269114599467),
    (5.435917640547676, -1.330672365324085),
    (4.847096509720092, -2.088102716890643),
    (4.211595189811423, -2.825423497820488),
    (3.535533905932749, -3.535533905932726),
    (2.825423497820511, -4.211595189811401),
    (2.088102716890668, -4.847096509720072),
    (1.33067236532411, -5.435917640547657),
    (0.5604269114599725, -5.972387912921915),
    (-0.2152157599220375, -6.4513408248554),
    (-0.9887857858870981, -6.8681637979839),
    (-1.752833264208773, -7.218842599217568),
    (-2.499999999999986, -7.499999999999996),
    (-3.223090369152185, -7.708928300865376),
    (-3.915140616129027, -7.843615408064548),
    (-4.569485918738979, -7.902764211127722),
    (-5.179824574016382, -7.885805074747377),
    (-5.740278687065863, -7.792901324677659),
    (-6.245450778403375, -7.624947674818098),
    (-6.690475764634179, -7.383561610629645),
    (-7.071067811865472, -7.071067811865479),
    (-7.383561610629639, -6.690475764634187),
    (-7.624947674818094, -6.245450778403384),
    (-7.792901324677658, -5.740278687065874),
    (-7.885805074747375, -5.179824574016394),
    (-7.902764211127724, -4.569485918738994),
    (-7.843615408064551, -3.915140616129041),
    (-7.708928300865379, -3.223090369152198),
    (-7.500000000000002, -2.500000000000002),
    (-7.218842599217577, -1.752833264208792),
    (-6.868163797983911, -0.9887857858871212),
    (-6.451340824855417, -0.2152157599220637),
    (-5.972387912921935, 0.5604269114599445),
    (-5.43591764054768, 1.330672365324081),
    (-4.847096509720098, 2.088102716890638),
    (-4.211595189811431, 2.825423497820481),
    (-3.535533905932758, 3.535533905932718),
    (-2.825423497820522, 4.211595189811392),
    (-2.08810271689068, 4.847096509720062),
    (-1.330672365324124, 5.435917640547647),
    (-0.5604269114599898, 5.972387912921905),
    (0.2152157599220188, 6.451340824855389),
    (0.9887857858870759, 6.86816379798389),
    (1.752833264208747, 7.218842599217559),
    (2.499999999999958, 7.499999999999987),
    (3.223090369152155, 7.708928300865368),
    (3.915140616128995, 7.843615408064543),
    (4.569485918738948, 7.902764211127721),
    (5.179824574016349, 7.885805074747379),
    (5.74027868706583, 7.792901324677667),
    (6.245450778403344, 7.624947674818111),
    (6.69047576463415, 7.383561610629664),
    (7.071067811865446, 7.071067811865505),
    (7.071067811865476, 7.071067811865476)))
